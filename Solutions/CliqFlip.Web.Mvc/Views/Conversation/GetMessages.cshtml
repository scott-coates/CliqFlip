@model IEnumerable<CliqFlip.Web.Mvc.ViewModels.MessageViewModel>


@for (int i = 0; i < Model.Count(); i++)
{
    var currentMessage = Model.ElementAt(i);
    CliqFlip.Web.Mvc.ViewModels.MessageViewModel nextMessage = null;
    //var theresMoreElements = i < Model.Count() - 1;

    Func<int, IEnumerable<CliqFlip.Web.Mvc.ViewModels.MessageViewModel>, bool> theresMoreElements = (int currentIndex, IEnumerable<CliqFlip.Web.Mvc.ViewModels.MessageViewModel> messages) =>
    {
        return currentIndex < messages.Count() - 1;
    };
    
    <div class="message">
        <img src="@currentMessage.SenderImageUrl" alt="Alternate Text" class="profile-image" />
        <strong>@currentMessage.Sender</strong>
        <p>
            @currentMessage.Text
        </p>
    
        @while (theresMoreElements(i, Model))
        {
            nextMessage = Model.ElementAt(i + 1);
            if (currentMessage.Sender == nextMessage.Sender)
            {
                i++;
                currentMessage = Model.ElementAt(i);   
                <p>
                    @currentMessage.Text
                </p>
            }
            else
            {
                break;
            }
        }
    </div>
}